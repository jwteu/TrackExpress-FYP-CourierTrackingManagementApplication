<ion-header class="ion-no-border">
  <ion-toolbar color="light">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/deliveryman-home" icon="arrow-back-outline"></ion-back-button>
    </ion-buttons>
    <ion-title>My Parcels</ion-title>
    <ion-buttons slot="end" *ngIf="selectedParcels.length > 0">
      <ion-button color="danger" (click)="removeSelectedParcels()">
        <ion-icon name="trash-outline"></ion-icon>
        <ion-badge color="danger">{{selectedParcels.length}}</ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">
  <!-- Add parcel form -->
  <div class="add-parcel-container">
    <form [formGroup]="addParcelForm" (ngSubmit)="addParcel()">
      <ion-item class="custom-input">
        <ion-label position="floating">Tracking ID</ion-label>
        <ion-input formControlName="trackingId" type="text"></ion-input>
        <ion-icon name="barcode-outline" slot="end"></ion-icon>
      </ion-item>
      
      <ion-button expand="block" type="submit" [disabled]="addParcelForm.invalid || isLoading" class="add-button">
        <ion-spinner *ngIf="isLoading"></ion-spinner>
        <ion-icon *ngIf="!isLoading" name="add-circle" slot="start"></ion-icon>
        <span *ngIf="!isLoading">Assign Parcel</span>
      </ion-button>
    </form>
  </div>

  <!-- Parcel list -->
  <div class="parcels-container">
    <div class="section-header">
      <h2 class="section-title">My Assigned Parcels</h2>
      <div class="selection-actions" *ngIf="parcels.length > 0">
        <ion-button fill="clear" size="small" (click)="selectAllParcels()" *ngIf="parcels.length !== selectedParcels.length">
          <ion-icon name="checkbox-outline" slot="start"></ion-icon>
          All
        </ion-button>
        <ion-button fill="clear" size="small" color="danger" (click)="removeSelectedParcels()" *ngIf="selectedParcels.length > 0">
          <ion-icon name="trash-outline" slot="start"></ion-icon>
          {{selectedParcels.length}}
        </ion-button>
      </div>
    </div>
    
    <!-- Empty state -->
    <div class="empty-state" *ngIf="parcels.length === 0">
      <ion-icon name="cube-outline"></ion-icon>
      <p>No parcels assigned yet</p>
    </div>
    
    <!-- Compact parcel list -->
    <div class="parcel-list">
      <ion-item *ngFor="let parcel of parcels" 
                class="parcel-item" 
                [class.selected]="isSelected(parcel.id)"
                lines="full">
        <ion-checkbox slot="start" 
                     [checked]="isSelected(parcel.id)" 
                     (ionChange)="onParcelSelection($event, parcel.id)">
        </ion-checkbox>
        
        <ion-label>
          <h2>{{parcel.trackingId}}</h2>
          <p class="info-row">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>{{formatDate(parcel.addedDate)}}</span>
          </p>
          <p class="info-row">
            <ion-icon name="location-outline"></ion-icon>
            <span>{{parcel.locationLat | number:'1.4-4'}}°, {{parcel.locationLng | number:'1.4-4'}}°</span>
          </p>
        </ion-label>
        
        <!-- Update the item actions section -->
        <div class="item-actions" slot="end" *ngIf="selectedParcels.length === 0">
          <ion-button fill="clear" size="small" (click)="viewParcelDetails(parcel)">
            <ion-icon name="eye-outline" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button fill="clear" size="small" color="danger" (click)="removeParcel(parcel.id)">
            <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </ion-item>
    </div>
  </div>

  <!-- Floating action button for batch deletion -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" *ngIf="selectedParcels.length > 0">
    <ion-fab-button color="danger" (click)="removeSelectedParcels()">
      <ion-icon name="trash"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>